(self.webpackChunk_plone_volto=self.webpackChunk_plone_volto||[]).push([[2924],{"./src/components/manage/Controlpanels/UndoControlpanel.jsx":function(__unused_webpack_module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{default:function(){return Controlpanels_UndoControlpanel}});var react=__webpack_require__("../../../node_modules/.pnpm/react@18.2.0/node_modules/react/index.js"),es=__webpack_require__("../../../node_modules/.pnpm/react-redux@8.1.2_@types+react-dom@18.2.12_@types+react@18.2.27_react-dom@18.2.0_react@18.2.0__react@18.2.0_redux@4.2.1/node_modules/react-redux/es/index.js"),redux=__webpack_require__("../../../node_modules/.pnpm/redux@4.2.1/node_modules/redux/es/redux.js"),react_router_dom=__webpack_require__("../../../node_modules/.pnpm/react-router-dom@5.2.0_react@18.2.0/node_modules/react-router-dom/esm/react-router-dom.js"),react_dom=__webpack_require__("../../../node_modules/.pnpm/react-dom@18.2.0_react@18.2.0/node_modules/react-dom/index.js"),Container=__webpack_require__("../../../node_modules/.pnpm/semantic-ui-react@2.1.5_react-dom@18.2.0_react@18.2.0__react@18.2.0/node_modules/semantic-ui-react/dist/es/elements/Container/Container.js"),Segment=__webpack_require__("../../../node_modules/.pnpm/semantic-ui-react@2.1.5_react-dom@18.2.0_react@18.2.0__react@18.2.0/node_modules/semantic-ui-react/dist/es/elements/Segment/Segment.js"),Table=__webpack_require__("../../../node_modules/.pnpm/semantic-ui-react@2.1.5_react-dom@18.2.0_react@18.2.0__react@18.2.0/node_modules/semantic-ui-react/dist/es/collections/Table/Table.js"),Input=__webpack_require__("../../../node_modules/.pnpm/semantic-ui-react@2.1.5_react-dom@18.2.0_react@18.2.0__react@18.2.0/node_modules/semantic-ui-react/dist/es/elements/Input/Input.js"),Menu=__webpack_require__("../../../node_modules/.pnpm/semantic-ui-react@2.1.5_react-dom@18.2.0_react@18.2.0__react@18.2.0/node_modules/semantic-ui-react/dist/es/collections/Menu/Menu.js"),lib=__webpack_require__("../../../node_modules/.pnpm/react-intl@3.12.1_react@18.2.0/node_modules/react-intl/lib/index.js"),message=__webpack_require__("../../../node_modules/.pnpm/react-intl@3.12.1_react@18.2.0/node_modules/react-intl/lib/components/message.js"),injectIntl=__webpack_require__("../../../node_modules/.pnpm/react-intl@3.12.1_react@18.2.0/node_modules/react-intl/lib/components/injectIntl.js"),Icon=__webpack_require__("./src/components/theme/Icon/Icon.jsx"),Toolbar=__webpack_require__("./src/components/manage/Toolbar/Toolbar.jsx"),Toast=__webpack_require__("./src/components/manage/Toast/Toast.jsx"),Form=__webpack_require__("./src/components/manage/Form/index.tsx"),back=__webpack_require__("./src/icons/back.svg"),back_default=__webpack_require__.n(back),map=__webpack_require__("../../../node_modules/.pnpm/lodash@4.17.21/node_modules/lodash/map.js"),map_default=__webpack_require__.n(map),Helmet=__webpack_require__("./src/helpers/Helmet/Helmet.jsx"),right_key=__webpack_require__("./src/icons/right-key.svg"),right_key_default=__webpack_require__.n(right_key),left_key=__webpack_require__("./src/icons/left-key.svg"),left_key_default=__webpack_require__.n(left_key),undo=__webpack_require__("./src/icons/undo.svg"),undo_default=__webpack_require__.n(undo),ActionTypes=__webpack_require__("./src/constants/ActionTypes.js");var react_toastify=__webpack_require__("../../../node_modules/.pnpm/react-toastify@5.5.0_react-dom@18.2.0_react@18.2.0__react@18.2.0/node_modules/react-toastify/esm/react-toastify.js"),__jsx=react.createElement;const messages=(0,lib.defineMessages)({success:{id:"Success",defaultMessage:"Success"},error:{id:"Error",defaultMessage:"Error"},undo:{id:"Undo",defaultMessage:"Undo"},back:{id:"Back",defaultMessage:"Back"},default:{id:"Default",defaultMessage:"Default"},sortBy:{id:"Sort By",defaultMessage:"Sort by"},sorted:{id:"Sorted",defaultMessage:"Sorted"},unsorted:{id:"Unsorted",defaultMessage:"Unsorted"},sortByDescription:{id:"Sort transactions by User-Name, Path or Date",defaultMessage:"Sort transactions by User-Name, Path or Date"},failedToUndoTransactions:{id:"Failed To Undo Transactions",defaultMessage:"Failed to undo transactions"},successfullyUndoneTransactions:{id:"Successfully Undone Transactions",defaultMessage:"Successfully undone transactions"},transactionsHaveBeenSorted:{id:"Transactions Have Been Sorted",defaultMessage:"Transactions have been sorted"},transactionsHaveBeenUnsorted:{id:"Transactions Have Been Unsorted",defaultMessage:"Transactions have been unsorted"},noTransactionsSelected:{id:"No Transactions Selected",defaultMessage:"No transactions selected"},noTransactionsSelectedToDoUndo:{id:"No Transactions Selected To Do Undo",defaultMessage:"No transactions selected to do undo"}});class UndoControlpanel extends react.Component{constructor(props){super(props),this.state={isClient:!1,sortType:"no value",lowerIndex:0,upperIndex:20,defaultTransactionsLenInTable:20,isSortingTypeSelected:!1,sortedTransactions:[],isEmptyInputForSorting:!1,isTransactionsNotFound:!1,isClickedOnUndoButton:!1,showPrevButton:!1,showNextButton:!1},this.onCancel=this.onCancel.bind(this),this.onSort=this.onSort.bind(this),this.onSelect=this.onSelect.bind(this),this.onPrev=this.onPrev.bind(this),this.onNext=this.onNext.bind(this),this.onUndo=this.onUndo.bind(this),this.handleTableVisiblity=this.handleTableVisiblity.bind(this),this.handleNotSortedNextPrevButtons=this.handleNotSortedNextPrevButtons.bind(this),this.handleSortedNextPrevButtons=this.handleSortedNextPrevButtons.bind(this),this.checkTransactionsUndoneStatus=this.checkTransactionsUndoneStatus.bind(this)}componentDidMount(){this.setState({isClient:!0}),this.props.getTransactions()}UNSAFE_componentWillReceiveProps(nextProps){this.props.revertRequest.loading&&nextProps.revertRequest.loaded&&this.props.getTransactions()}setSortedTransactions(sortedTransactions){sortedTransactions.length>0?this.setState({lowerIndex:0,upperIndex:this.state.defaultTransactionsLenInTable,sortedTransactions:sortedTransactions,isEmptyInputForSorting:!1,isTransactionsNotFound:!1}):this.setState({isTransactionsNotFound:!0})}onCancel(){this.state.sortedTransactions.length>0&&react_toastify.toast.info(__jsx(Toast.c,{info:!0,title:this.props.intl.formatMessage(messages.unsorted),content:this.props.intl.formatMessage(messages.transactionsHaveBeenUnsorted)})),this.setState({isSortingTypeSelected:!1,isTransactionsNotFound:!1,isEmptyInputForSorting:!1,sortType:"no value",sortedTransactions:[],lowerIndex:0,upperIndex:this.state.defaultTransactionsLenInTable})}onSelect(data){if(null!==data&&null!==data.sortingTypes&&this.state.sortType.toLowerCase()===data.sortingTypes.toLowerCase())return;let sortType=null!==data&&data.sortingTypes||"no value";"no value"!==sortType.toLowerCase()?(this.setState({isSortingTypeSelected:!0}),"user name"===sortType.toLowerCase()&&this.setState({sortType:"user name"}),"date"===sortType.toLowerCase()&&this.setState({sortType:"date"}),"path"===sortType.toLowerCase()&&this.setState({sortType:"path"})):this.onCancel()}onSort(data){let value,sortType=data.sortingTypes||"no value";if("user name"===sortType.toLowerCase()&&(value=data.sortByUsername)||"path"===sortType.toLowerCase()&&(value=data.sortByPath)||"date"===sortType.toLowerCase()&&(value=data.sortByDate)||(value=void 0),"no value"!==sortType.toLowerCase()&&void 0!==value){let sortedTransactions=[];if("user name"===sortType.toLowerCase())this.props.transactions.forEach((element=>{"zope"!==value.trim().toLowerCase()||element.username?element.username.trim().toLowerCase().includes(value.trim().toLowerCase())&&sortedTransactions.push(element):sortedTransactions.push(element)})),this.setSortedTransactions(sortedTransactions);else if("path"===sortType.toLowerCase())this.props.transactions.forEach((element=>{element.id.trim().toLowerCase().includes(value.trim().toLowerCase())&&sortedTransactions.push(element)})),this.setSortedTransactions(sortedTransactions);else{let MSInADay=864e5,sortingTimeInMS=Date.parse(value),endTimeOfSortingDateInMS=sortingTimeInMS-sortingTimeInMS%MSInADay+MSInADay-1,startTimeOfSortingDateInMS=sortingTimeInMS-sortingTimeInMS%MSInADay;this.props.transactions.forEach((element=>{endTimeOfSortingDateInMS>=Date.parse(element.time)&&Date.parse(element.time)>=startTimeOfSortingDateInMS&&sortedTransactions.push(element)})),this.setSortedTransactions(sortedTransactions)}react_toastify.toast.info(__jsx(Toast.c,{info:!0,title:this.props.intl.formatMessage(messages.sorted),content:this.props.intl.formatMessage(messages.transactionsHaveBeenSorted)}))}else this.setState({isEmptyInputForSorting:!0})}onUndo(){let transactionsSelected=!1,undoTransactionsIds=map_default()(this.props.transactions.slice(0,this.props.transactions.length),(transaction=>null!==document.getElementById(transaction.id)&&document.getElementById(transaction.id).firstElementChild.firstElementChild.firstElementChild.checked?(transactionsSelected=!0,transaction.id):""));transactionsSelected?(this.setState({isClickedOnUndoButton:!0}),this.props.revertTransactions(undoTransactionsIds)):react_toastify.toast.error(__jsx(Toast.c,{error:!0,title:this.props.intl.formatMessage(messages.noTransactionsSelected),content:this.props.intl.formatMessage(messages.noTransactionsSelectedToDoUndo)})),Array.from(document.getElementsByClassName("transactions-checkboxes")).forEach((element=>{element.firstElementChild.checked=!1}))}onPrev(){0<this.state.lowerIndex&&this.setState({upperIndex:this.state.lowerIndex,lowerIndex:this.state.lowerIndex-this.state.defaultTransactionsLenInTable})}onNext(){this.props.transactions.length>this.state.upperIndex&&this.setState({lowerIndex:this.state.upperIndex,upperIndex:this.state.upperIndex+this.state.defaultTransactionsLenInTable})}handleSortedNextPrevButtons(){this.state.upperIndex>=this.state.sortedTransactions.length&&this.state.showNextButton&&this.setState({showNextButton:!1}),this.state.upperIndex<this.state.sortedTransactions.length&&!this.state.showNextButton&&this.setState({showNextButton:!0}),this.state.lowerIndex<=0&&this.state.showPrevButton&&this.setState({showPrevButton:!1}),this.state.lowerIndex>0&&!this.state.showPrevButton&&this.setState({showPrevButton:!0})}handleNotSortedNextPrevButtons(){var _this$props$transacti,_this$props$transacti2;this.state.upperIndex>=(null===(_this$props$transacti=this.props.transactions)||void 0===_this$props$transacti?void 0:_this$props$transacti.length)&&this.state.showNextButton&&this.setState({showNextButton:!1}),this.state.upperIndex<(null===(_this$props$transacti2=this.props.transactions)||void 0===_this$props$transacti2?void 0:_this$props$transacti2.length)&&!this.state.showNextButton&&this.setState({showNextButton:!0}),this.state.lowerIndex<=0&&this.state.showPrevButton&&this.setState({showPrevButton:!1}),this.state.lowerIndex>0&&!this.state.showPrevButton&&this.setState({showPrevButton:!0})}handleTableVisiblity(){if(this.state.sortedTransactions.length>0)this.handleSortedNextPrevButtons();else if(this.state.isSortingTypeSelected)this.handleNotSortedNextPrevButtons();else{var _this$props$transacti3,_this$props$transacti4;(null===(_this$props$transacti3=this.props.transactions)||void 0===_this$props$transacti3?void 0:_this$props$transacti3.length)>0&&this.state.isTransactionsNotFound&&this.setState({isTransactionsNotFound:!1}),(null===(_this$props$transacti4=this.props.transactions)||void 0===_this$props$transacti4?void 0:_this$props$transacti4.length)<=0&&!this.state.isTransactionsNotFound&&this.setState({isTransactionsNotFound:!0}),this.handleNotSortedNextPrevButtons()}}checkTransactionsUndoneStatus(){this.props.revertRequest.error&&null!==this.props.revertRequest.error&&this.state.isClickedOnUndoButton?(this.setState({isClickedOnUndoButton:!1}),react_toastify.toast.error(__jsx(Toast.c,{error:!0,title:this.props.intl.formatMessage(messages.error),content:this.props.intl.formatMessage(messages.failedToUndoTransactions)}))):null===this.props.revertRequest.error&&this.state.isClickedOnUndoButton&&(this.setState({isClickedOnUndoButton:!1}),react_toastify.toast.success(__jsx(Toast.c,{success:!0,title:this.props.intl.formatMessage(messages.success),content:this.props.intl.formatMessage(messages.successfullyUndoneTransactions)})))}render(){var _this$props$transacti5,_this$props$transacti6;const transactionsRange=this.state.sortedTransactions.length>0&&this.state.sortedTransactions.slice(this.state.lowerIndex,this.state.upperIndex)||(null===(_this$props$transacti5=this.props.transactions)||void 0===_this$props$transacti5?void 0:_this$props$transacti5.slice(this.state.lowerIndex,this.state.upperIndex));return this.handleTableVisiblity(),this.checkTransactionsUndoneStatus(),__jsx(Container.c,{id:"page-undo",className:"controlpanel-undo"},__jsx(Helmet.c,{title:"Undo"}),__jsx(Segment.c.Group,{raised:!0},__jsx(Segment.c,{className:"primary"},__jsx(message.c,{id:"Undo Controlpanel",defaultMessage:"Undo Controlpanel"})),__jsx(Segment.c,null,(null===(_this$props$transacti6=this.props.transactions)||void 0===_this$props$transacti6?void 0:_this$props$transacti6.length)>0&&__jsx(Form.QF,{schema:{fieldsets:[{id:"default",title:this.props.intl.formatMessage(messages.default),fields:this.state.isSortingTypeSelected?["sortingTypes",("user name"===this.state.sortType.toLowerCase()?"sortByUsername":"path"===this.state.sortType.toLowerCase()&&"sortByPath")||"date"===this.state.sortType.toLowerCase()&&"sortByDate"]:["sortingTypes"]}],properties:{sortingTypes:{title:this.props.intl.formatMessage(messages.sortBy),description:this.props.intl.formatMessage(messages.sortByDescription),type:"string",choices:map_default()(["User Name","Path","Date"],(type=>[type,type]))},sortByUsername:{title:"Enter Username",type:"string"},sortByPath:{title:"Enter Path",type:"string"},sortByDate:{title:"Enter Date and Time",type:"date"}},required:[]},error:this.state.isEmptyInputForSorting?{message:"Please enter any input to perform sorting"}:void 0,onChangeFormData:this.onSelect,onSubmit:this.state.isSortingTypeSelected?this.onSort:void 0,onCancel:this.state.isSortingTypeSelected?this.onCancel:void 0,resetOnCancel:!0})),__jsx(Segment.c.Group,{raised:!0},__jsx(Segment.c,{className:"primary"},__jsx(message.c,{id:"Transactions",defaultMessage:"Transactions"})),this.state.isTransactionsNotFound?__jsx(Segment.c,null,__jsx(message.c,{id:"No Transactions Found",defaultMessage:"No transactions found"})):__jsx(Table.c,{selectable:!0,fixed:!0,celled:!0,compact:!0,singleLine:!0,attached:!0},__jsx(Table.c.Header,null,__jsx(Table.c.Row,null,__jsx(Table.c.HeaderCell,{width:1},__jsx(message.c,{id:"Transactions Checkbox",defaultMessage:"#"})),__jsx(Table.c.HeaderCell,{width:3},__jsx(message.c,{id:"What",defaultMessage:"What"})),__jsx(Table.c.HeaderCell,{width:3},__jsx(message.c,{id:"Who",defaultMessage:"Who"})),__jsx(Table.c.HeaderCell,{width:3},__jsx(message.c,{id:"When",defaultMessage:"When"})),__jsx(Table.c.HeaderCell,{width:3},__jsx(message.c,{id:"Note",defaultMessage:"Note"})),__jsx(Table.c.HeaderCell,null))),__jsx(Table.c.Body,null,map_default()(transactionsRange,(transaction=>__jsx(Table.c.Row,{id:transaction.id,key:transaction.id},__jsx(Table.c.Cell,{width:1},__jsx(Input.c,{type:"checkbox",className:"transactions-checkboxes"})),__jsx(Table.c.Cell,{width:3,title:[transaction.description].join(" ")},transaction.description),__jsx(Table.c.Cell,{width:3},transaction.username?transaction.username:"Zope"),__jsx(Table.c.Cell,{width:3},transaction.time),__jsx(Table.c.Cell,{width:3},transaction.description.includes("Undo")?"Undone":""))))),__jsx(Table.c.Footer,null,__jsx(Table.c.Row,null,__jsx(Table.c.HeaderCell,{textAlign:"center",colSpan:"6"},__jsx(Menu.c,{pagination:!0},__jsx(Menu.c.Item,{as:"a",id:"prev-button",icon:!0},this.state.showPrevButton?__jsx(Icon.c,{onClick:this.onPrev,name:left_key_default(),title:"Prev"}):__jsx("div",{style:{width:"36px"}})),__jsx(Menu.c.Item,{as:"a",icon:!0},__jsx(Icon.c,{name:undo_default(),id:"undo-button",className:"circled",size:"30px",title:this.props.intl.formatMessage(messages.undo),onClick:this.onUndo})),__jsx(Menu.c.Item,{as:"a",id:"next-button",icon:!0},this.state.showNextButton?__jsx(Icon.c,{onClick:this.onNext,name:right_key_default(),title:"Next"}):__jsx("div",{style:{width:"36px"}}))))))))),this.state.isClient&&(0,react_dom.createPortal)(__jsx(Toolbar.c,{pathname:this.props.pathname,hideDefaultViewButtons:!0,inner:__jsx(react.Fragment,null,__jsx(react_router_dom.cH,{to:"/controlpanel",className:"item"},__jsx(Icon.c,{name:back_default(),"aria-label":this.props.intl.formatMessage(messages.back),className:"contents circled",size:"30px",title:this.props.intl.formatMessage(messages.back)})))}),document.getElementById("toolbar")))}}var Controlpanels_UndoControlpanel=(0,redux.compose)(injectIntl.cp,(0,es.connect)(((state,props)=>({pathname:props.location.pathname,transactions:state.transactions.transactions_recieved,revertRequest:state.transactions.revert})),{getTransactions:function getTransactions(){return{type:ActionTypes.XQ,request:{op:"get",path:"/@transactions"}}},revertTransactions:function revertTransactions(transaction_ids){return{type:ActionTypes.aK,request:{op:"patch",path:"/@transactions",data:{transaction_ids:transaction_ids}}}}}))(UndoControlpanel);UndoControlpanel.__docgenInfo={description:"UndoControlpanel class.\n@class UndoControlpanel\n@extends Component",methods:[{name:"setSortedTransactions",docblock:null,modifiers:[],params:[{name:"sortedTransactions",optional:!1,type:null}],returns:null},{name:"onCancel",docblock:"On Cancel\n@method onCancel\n@returns {undefined}",modifiers:[],params:[],returns:{},description:"On Cancel"},{name:"onSelect",docblock:"On Select\n@method onSelect\n@param {object} data\n@returns {undefined}",modifiers:[],params:[{name:"data",type:{name:"object"},optional:!1}],returns:{},description:"On Select"},{name:"onSort",docblock:"On Sort\n@method onSort\n@param {object} data\n@returns {undefined}",modifiers:[],params:[{name:"data",type:{name:"object"},optional:!1}],returns:{},description:"On Sort"},{name:"onUndo",docblock:"On Undo\n@method onUndo\n@returns {undefined}",modifiers:[],params:[],returns:{},description:"On Undo"},{name:"onPrev",docblock:"On Prev\n@method onPrev\n@returns {undefined}",modifiers:[],params:[],returns:{},description:"On Prev"},{name:"onNext",docblock:"On Next\n@method onNext\n@returns {undefined}",modifiers:[],params:[],returns:{},description:"On Next"},{name:"handleSortedNextPrevButtons",docblock:"Handle next and prev buttons visibility when transactions are sorted\n@method handleSortedNextPrevButtons\n@returns {undefined}",modifiers:[],params:[],returns:{},description:"Handle next and prev buttons visibility when transactions are sorted"},{name:"handleNotSortedNextPrevButtons",docblock:"Handle next and prev buttons visibility when transactions are not sorted\n@method handleNotSortedNextPrevButtons\n@returns {undefined}",modifiers:[],params:[],returns:{},description:"Handle next and prev buttons visibility when transactions are not sorted"},{name:"handleTableVisiblity",docblock:"Handle next, prev buttons and table visibility\n@method handleTableVisiblity\n@returns {undefined}",modifiers:[],params:[],returns:{},description:"Handle next, prev buttons and table visibility"},{name:"checkTransactionsUndoneStatus",docblock:"Check transactions undone status\n@method checkTransactionsUndoneStatus\n@returns {undefined}",modifiers:[],params:[],returns:{},description:"Check transactions undone status"}],displayName:"UndoControlpanel",props:{getTransactions:{description:"",type:{name:"func"},required:!0},revertTransactions:{description:"",type:{name:"func"},required:!0},transactions:{description:"",type:{name:"arrayOf",value:{name:"shape",value:{description:{name:"string",required:!1},id:{name:"string",required:!1},size:{name:"number",required:!1},time:{name:"string",required:!1},username:{name:"string",required:!1}}}},required:!1},revertRequest:{description:"",type:{name:"shape",value:{loaded:{name:"bool",required:!1},loading:{name:"bool",required:!1}}},required:!0}}}},"./src/icons/undo.svg":function(module){module.exports={attributes:{xmlns:"http://www.w3.org/2000/svg",width:"36",height:"36",viewBox:"0 0 36 36"},content:'<path fill-rule="evenodd" d="M19,9 L10.527,9 L13.719,5.695 L12.281,4.305 L6.781,10 L12.281,15.695 L13.719,14.305 L10.527,11 L19,11 C23.411,11 27,14.589 27,19 C27,23.411 23.411,27 19,27 L18,27 L18,29 L19,29 C24.514,29 29,24.514 29,19 C29,13.486 24.514,9 19,9"/>'}}}]);