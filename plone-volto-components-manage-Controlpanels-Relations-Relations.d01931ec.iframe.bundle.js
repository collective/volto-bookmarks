(self.webpackChunk_plone_volto=self.webpackChunk_plone_volto||[]).push([[6296],{"./src/components/manage/Controlpanels/Relations/Relations.jsx":function(__unused_webpack_module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{default:function(){return Relations}});var react=__webpack_require__("../../../node_modules/.pnpm/react@18.2.0/node_modules/react/index.js"),find=__webpack_require__("../../../node_modules/.pnpm/lodash@4.17.21/node_modules/lodash/find.js"),find_default=__webpack_require__.n(find),es=__webpack_require__("../../../node_modules/.pnpm/react-redux@8.1.2_@types+react-dom@18.2.12_@types+react@18.2.27_react-dom@18.2.0_react@18.2.0__react@18.2.0_redux@4.2.1/node_modules/react-redux/es/index.js"),react_dom=__webpack_require__("../../../node_modules/.pnpm/react-dom@18.2.0_react@18.2.0/node_modules/react-dom/index.js"),react_router=__webpack_require__("../../../node_modules/.pnpm/react-router@5.2.0_react@18.2.0/node_modules/react-router/esm/react-router.js"),react_router_dom=__webpack_require__("../../../node_modules/.pnpm/react-router-dom@5.2.0_react@18.2.0/node_modules/react-router-dom/esm/react-router-dom.js"),useIntl=__webpack_require__("../../../node_modules/.pnpm/react-intl@3.12.1_react@18.2.0/node_modules/react-intl/lib/components/useIntl.js"),message=__webpack_require__("../../../node_modules/.pnpm/react-intl@3.12.1_react@18.2.0/node_modules/react-intl/lib/components/message.js"),Segment=__webpack_require__("../../../node_modules/.pnpm/semantic-ui-react@2.1.5_react-dom@18.2.0_react@18.2.0__react@18.2.0/node_modules/semantic-ui-react/dist/es/elements/Segment/Segment.js"),Message=__webpack_require__("../../../node_modules/.pnpm/semantic-ui-react@2.1.5_react-dom@18.2.0_react@18.2.0__react@18.2.0/node_modules/semantic-ui-react/dist/es/collections/Message/Message.js"),Divider=__webpack_require__("../../../node_modules/.pnpm/semantic-ui-react@2.1.5_react-dom@18.2.0_react@18.2.0__react@18.2.0/node_modules/semantic-ui-react/dist/es/elements/Divider/Divider.js"),Helmet=__webpack_require__("./src/helpers/Helmet/Helmet.jsx"),MessageLabels=__webpack_require__("./src/helpers/MessageLabels/MessageLabels.js"),actions_actions=__webpack_require__("./src/actions/actions/actions.js"),Icon=__webpack_require__("./src/components/theme/Icon/Icon.jsx"),Toolbar=__webpack_require__("./src/components/manage/Toolbar/Toolbar.jsx"),Url=__webpack_require__("./src/helpers/Url/Url.js"),capitalize=__webpack_require__("../../../node_modules/.pnpm/lodash@4.17.21/node_modules/lodash/capitalize.js"),capitalize_default=__webpack_require__.n(capitalize),redux=__webpack_require__("../../../node_modules/.pnpm/redux@4.2.1/node_modules/redux/es/redux.js"),react_toastify=__webpack_require__("../../../node_modules/.pnpm/react-toastify@5.5.0_react-dom@18.2.0_react@18.2.0__react@18.2.0/node_modules/react-toastify/esm/react-toastify.js"),Tab=__webpack_require__("../../../node_modules/.pnpm/semantic-ui-react@2.1.5_react-dom@18.2.0_react@18.2.0__react@18.2.0/node_modules/semantic-ui-react/dist/es/modules/Tab/Tab.js"),Form=__webpack_require__("../../../node_modules/.pnpm/semantic-ui-react@2.1.5_react-dom@18.2.0_react@18.2.0__react@18.2.0/node_modules/semantic-ui-react/dist/es/collections/Form/Form.js"),Header=__webpack_require__("../../../node_modules/.pnpm/semantic-ui-react@2.1.5_react-dom@18.2.0_react@18.2.0__react@18.2.0/node_modules/semantic-ui-react/dist/es/elements/Header/Header.js"),Dropdown=__webpack_require__("../../../node_modules/.pnpm/semantic-ui-react@2.1.5_react-dom@18.2.0_react@18.2.0__react@18.2.0/node_modules/semantic-ui-react/dist/es/modules/Dropdown/Dropdown.js"),Input=__webpack_require__("../../../node_modules/.pnpm/semantic-ui-react@2.1.5_react-dom@18.2.0_react@18.2.0__react@18.2.0/node_modules/semantic-ui-react/dist/es/elements/Input/Input.js"),Button=__webpack_require__("../../../node_modules/.pnpm/semantic-ui-react@2.1.5_react-dom@18.2.0_react@18.2.0__react@18.2.0/node_modules/semantic-ui-react/dist/es/elements/Button/Button.js"),Popup=__webpack_require__("../../../node_modules/.pnpm/semantic-ui-react@2.1.5_react-dom@18.2.0_react@18.2.0__react@18.2.0/node_modules/semantic-ui-react/dist/es/modules/Popup/Popup.js"),ObjectBrowser=__webpack_require__("./src/components/manage/Sidebar/ObjectBrowser.jsx"),Toast=__webpack_require__("./src/components/manage/Toast/Toast.jsx"),relations_relations=__webpack_require__("./src/actions/relations/relations.js"),ActionTypes=__webpack_require__("./src/constants/ActionTypes.js");var objectSpread2=__webpack_require__("../../../node_modules/.pnpm/@babel+runtime@7.20.6/node_modules/@babel/runtime/helpers/esm/objectSpread2.js"),use_deep_compare_effect_esm=__webpack_require__("../../../node_modules/.pnpm/use-deep-compare-effect@1.8.1_react@18.2.0/node_modules/use-deep-compare-effect/dist/use-deep-compare-effect.esm.js"),uniqBy=__webpack_require__("../../../node_modules/.pnpm/lodash@4.17.21/node_modules/lodash/uniqBy.js"),uniqBy_default=__webpack_require__.n(uniqBy),Checkbox=__webpack_require__("../../../node_modules/.pnpm/semantic-ui-react@2.1.5_react-dom@18.2.0_react@18.2.0__react@18.2.0/node_modules/semantic-ui-react/dist/es/modules/Checkbox/Checkbox.js"),UniversalLink=__webpack_require__("./src/components/manage/UniversalLink/UniversalLink.jsx"),search=__webpack_require__("./src/actions/search/search.js"),__jsx=react.createElement;const RelationsListing=({relationtype:relationtype,query_source:query_source,query_target:query_target,potential_sources_path:potential_sources_path,potential_targets_path:potential_targets_path})=>{var _matrix_options,_matrix_options2;const intl=(0,useIntl.c)(),dispatch=(0,es.useDispatch)(),stats=(0,es.useSelector)((state=>{var _state$relations,_state$relations$stat;return(null===(_state$relations=state.relations)||void 0===_state$relations||null===(_state$relations$stat=_state$relations.stats)||void 0===_state$relations$stat?void 0:_state$relations$stat.data)||null}));let relations=(0,es.useSelector)((state=>{var _state$relations2,_state$relations2$rel,_state$relations2$rel2,_state$relations2$rel3;return(null===(_state$relations2=state.relations)||void 0===_state$relations2||null===(_state$relations2$rel=_state$relations2.relations)||void 0===_state$relations2$rel||null===(_state$relations2$rel2=_state$relations2$rel.data)||void 0===_state$relations2$rel2||null===(_state$relations2$rel3=_state$relations2$rel2[relationtype])||void 0===_state$relations2$rel3?void 0:_state$relations2$rel3.items)||[]})),potential_targets_objects=(0,es.useSelector)((state=>{var _state$search$subrequ;return(null===(_state$search$subrequ=state.search.subrequests.potential_targets)||void 0===_state$search$subrequ?void 0:_state$search$subrequ.items)||[]})),potential_sources_objects=(0,es.useSelector)((state=>{var _state$search$subrequ2;return(null===(_state$search$subrequ2=state.search.subrequests.potential_sources)||void 0===_state$search$subrequ2?void 0:_state$search$subrequ2.items)||[]}));const staticCatalogVocabularyQuery=(0,es.useSelector)((state=>{var _state$relations3,_state$relations3$rel,_state$relations3$rel2,_state$relations3$rel3;return(null===(_state$relations3=state.relations)||void 0===_state$relations3||null===(_state$relations3$rel=_state$relations3.relations)||void 0===_state$relations3$rel||null===(_state$relations3$rel2=_state$relations3$rel.data)||void 0===_state$relations3$rel2||null===(_state$relations3$rel3=_state$relations3$rel2[relationtype])||void 0===_state$relations3$rel3?void 0:_state$relations3$rel3.staticCatalogVocabularyQuery)||{}})),editable=(0,es.useSelector)((state=>{var _state$relations4,_state$relations4$rel,_state$relations4$rel2,_state$relations4$rel3;return!0!==(null===(_state$relations4=state.relations)||void 0===_state$relations4||null===(_state$relations4$rel=_state$relations4.relations)||void 0===_state$relations4$rel||null===(_state$relations4$rel2=_state$relations4$rel.data)||void 0===_state$relations4$rel2||null===(_state$relations4$rel3=_state$relations4$rel2[relationtype])||void 0===_state$relations4$rel3?void 0:_state$relations4$rel3.readonly)}));let relationMatrix={};relations.map((tpl=>(relationMatrix[tpl.source.UID]?relationMatrix[tpl.source.UID].targets.push(tpl.target):relationMatrix[tpl.source.UID]={source:tpl.source,targets:[tpl.target]},relationMatrix)));let matrix_options=relations.map((relation=>({value:relation.target.UID,label:relation.target.title,url:relation.target["@id"],review_state:relation.target.review_state,uid:relation.target.UID})));matrix_options=uniqBy_default()(matrix_options,(function(el){return el.value}));const potential_targets=potential_targets_objects.map((obj=>({value:obj.UID,label:obj.title,url:obj["@id"],review_state:obj.review_state,uid:obj.UID})));matrix_options=""===query_source&&""===query_target&&""!==potential_sources_path&&""!==potential_targets_path?potential_targets:[...matrix_options,...potential_targets],matrix_options=uniqBy_default()(matrix_options,(function(el){return el.value})),matrix_options.sort((function(a,b){var labelA=a.label.toUpperCase(),labelB=b.label.toUpperCase();return labelA<labelB?-1:labelA>labelB?1:0}));let items=Object.keys(relationMatrix).map((key=>({value:key,label:relationMatrix[key].source.title,targets:relationMatrix[key].targets.map((el=>el.UID)),url:relationMatrix[key].source["@id"],review_state:relationMatrix[key].source.review_state})));const potential_sources=potential_sources_objects.map((obj=>{var _relationMatrix$obj$U,_relationMatrix$obj$U2;return{value:obj.UID,label:obj.title,targets:(null===(_relationMatrix$obj$U=relationMatrix[obj.UID])||void 0===_relationMatrix$obj$U||null===(_relationMatrix$obj$U2=_relationMatrix$obj$U.targets)||void 0===_relationMatrix$obj$U2?void 0:_relationMatrix$obj$U2.map((el=>el.UID)))||[],url:obj["@id"],review_state:obj.review_state}}));function fetchRelations(){dispatch((0,relations_relations.yY)(relationtype,!1,null,null,null,query_source?query_source.startsWith("/")?query_source:`${query_source}*`:null,query_target?query_target.startsWith("/")?query_target:`${query_target}*`:null))}items=""===query_source&&""===query_target&&""!==potential_sources_path&&""!==potential_targets_path?potential_sources:[...items,...potential_sources],items=uniqBy_default()(items,(function(el){return el.value})),items.sort((function(a,b){var labelA=a.label.toUpperCase(),labelB=b.label.toUpperCase();return labelA<labelB?-1:labelA>labelB?1:0})),(0,react.useEffect)((()=>{(null==stats?void 0:stats.stats[relationtype])<=1e3?dispatch((0,relations_relations.yY)(relationtype)):dispatch((0,relations_relations.yY)(relationtype,!1,null,null,null,query_source?query_source.startsWith("/")?query_source:`${query_source}*`:null,query_target?query_target.startsWith("/")?query_target:`${query_target}*`:null))}),[dispatch,stats,relationtype,query_source,query_target]),(0,use_deep_compare_effect_esm.cp)((()=>{dispatch("/"!==potential_targets_path&&""!==potential_targets_path?(0,search.M)(potential_targets_path,(0,objectSpread2.c)({SearchableText:query_target,metadata_fields:["UID"],sort_on:"sortable_title"},staticCatalogVocabularyQuery),"potential_targets"):(0,search.k)("potential_targets")),dispatch("/"!==potential_sources_path&&""!==potential_sources_path?(0,search.M)(potential_sources_path,{SearchableText:query_source,metadata_fields:["UID"],sort_on:"sortable_title"},"potential_sources"):(0,search.k)("potential_sources"))}),[dispatch,potential_targets_path,potential_sources_path,staticCatalogVocabularyQuery,query_source,query_target]);return __jsx(react.Fragment,null,matrix_options.length<=40&&items.length<=40&matrix_options.length>0&&items.length>0?__jsx("div",{className:"administration_matrix"},__jsx("div",{className:"label-options"},__jsx("div",{className:"target-labels"},__jsx("div",null),__jsx("div",null,null===(_matrix_options=matrix_options)||void 0===_matrix_options?void 0:_matrix_options.map((matrix_option=>__jsx("div",{className:"label-options-label inclined",id:`label-options-label-${matrix_option.value}`,key:matrix_option.value},__jsx("div",null,__jsx(UniversalLink.c,{href:matrix_option.url,className:"published"!==matrix_option.review_state?"not-published":"",target:"_blank"},__jsx("span",{className:"label",title:matrix_option.label},matrix_option.label.length>30?matrix_option.label.slice(0,27)+"...":matrix_option.label)))))))),__jsx("div",{className:"listing-row selectall",key:"selectall"},__jsx("div",{className:"listing-item"},__jsx("div",null),__jsx("div",{className:"matrix_options"},"isReferencing"!==relationtype&&"iterate-working-copy"!==relationtype&&editable?null===(_matrix_options2=matrix_options)||void 0===_matrix_options2?void 0:_matrix_options2.map((matrix_option=>__jsx("div",{key:matrix_option.value,title:intl.formatMessage(MessageLabels.c.createOrDeleteRelationsToTarget)+` '${matrix_option.label}'`},__jsx(Checkbox.c,{className:"toggle-target",defaultChecked:!1,onChange:(event,{checked:checked})=>((target,items_ids,checked)=>{let relation_data=[];items_ids.forEach((el=>{relation_data.push({source:el,target:target,relation:relationtype})})),dispatch(checked?(0,relations_relations.Mh)(relation_data):(0,relations_relations.eu)(relation_data)).then((resp=>{fetchRelations()})).then((()=>{react_toastify.toast.success(__jsx(Toast.c,{success:!0,title:intl.formatMessage(MessageLabels.c.success),content:intl.formatMessage(MessageLabels.c.relationsUpdated)}))}))})(matrix_option.value,items.map((el=>el.value)),checked)})))):__jsx(message.c,{id:"Read only for this type of relation.",defaultMessage:"Read only for this type of relation."}))))),__jsx("div",{className:"items",key:"items"},__jsx(react.Fragment,null,!editable&&__jsx(Message.c,{warning:!0},__jsx(message.c,{id:"Relations are editable with plone.api >= 2.0.3.",defaultMessage:"Relations are editable with plone.api >= 2.0.3."})),items.map((item=>{var _matrix_options3;return __jsx("div",{className:"listing-row",key:item.id,id:`source-row-${item.value}`},__jsx("div",{className:"listing-item",key:item["@id"]},__jsx("div",null,__jsx("span",{title:item.label,className:"item-title"},__jsx(UniversalLink.c,{href:item.url,className:"published"!==item.review_state?"not-published":"",target:"_blank"},item.label.length>25?item.label.slice(0,22)+"...":item.label))),__jsx("div",{className:"matrix_options"},null===(_matrix_options3=matrix_options)||void 0===_matrix_options3?void 0:_matrix_options3.map((matrix_option=>__jsx(react.Fragment,{key:matrix_option.value},__jsx(Checkbox.c,{className:`checkbox_${matrix_option.value}`,key:matrix_option.value,title:matrix_option.title,disabled:"isReferencing"===relationtype||"iterate-working-copy"===relationtype||!editable,checked:item.targets.includes(matrix_option.value),onChange:(event,{checked:checked})=>{((relation,selectedvalue,checked)=>{const relation_data=[{source:selectedvalue.y,target:selectedvalue.x,relation:relation}];dispatch(checked?(0,relations_relations.Mh)(relation_data):(0,relations_relations.eu)(relation_data)).then((resp=>{fetchRelations()})).then((()=>{react_toastify.toast.success(__jsx(Toast.c,{success:!0,title:intl.formatMessage(MessageLabels.c.success),content:intl.formatMessage(MessageLabels.c.relationsUpdated)}))}))})(relationtype,{x:matrix_option.value,y:item.value},checked)}})))))))}))))):__jsx("div",{className:"administration_matrix"},matrix_options.length>40||items.length>40?__jsx(message.c,{id:"narrowDownRelations",defaultMessage:"Found {sources} sources and {targets} targets. Narrow down to {max}!",values:{sources:items.length,targets:matrix_options.length,max:40}}):__jsx("div",null,query_source||query_target?intl.formatMessage(MessageLabels.c.norelationfound):intl.formatMessage(MessageLabels.c.toomanyrelationsfound))))};var Relations_RelationsListing=RelationsListing;RelationsListing.__docgenInfo={description:"",methods:[],displayName:"RelationsListing"};var Table=__webpack_require__("../../../node_modules/.pnpm/semantic-ui-react@2.1.5_react-dom@18.2.0_react@18.2.0__react@18.2.0/node_modules/semantic-ui-react/dist/es/collections/Table/Table.js"),ConditionalLink=__webpack_require__("./src/components/manage/ConditionalLink/ConditionalLink.jsx"),BrokenRelations_jsx=react.createElement;const BrokenRelations=()=>{const dispatch=(0,es.useDispatch)(),brokenRelationStats=(0,es.useSelector)((state=>{var _state$relations,_state$relations$stat,_state$relations$stat2;return(null===(_state$relations=state.relations)||void 0===_state$relations||null===(_state$relations$stat=_state$relations.stats)||void 0===_state$relations$stat||null===(_state$relations$stat2=_state$relations$stat.data)||void 0===_state$relations$stat2?void 0:_state$relations$stat2.broken)||{}})),brokenRelations=(0,es.useSelector)((state=>{var _state$relations2,_state$relations2$sub,_state$relations2$sub2;return null===(_state$relations2=state.relations)||void 0===_state$relations2||null===(_state$relations2$sub=_state$relations2.subrequests)||void 0===_state$relations2$sub||null===(_state$relations2$sub2=_state$relations2$sub.broken)||void 0===_state$relations2$sub2?void 0:_state$relations2$sub2.data}));return(0,react.useEffect)((()=>{dispatch((0,relations_relations.yY)(null,!0,"broken"))}),[dispatch]),brokenRelations&&Object.keys(brokenRelations).length>0?BrokenRelations_jsx(react.Fragment,null,BrokenRelations_jsx(Divider.c,{section:!0,hidden:!0}),BrokenRelations_jsx(Segment.c,null,BrokenRelations_jsx("h3",null,BrokenRelations_jsx(message.c,{id:"Broken relations",defaultMessage:"Broken relations"})),Object.keys(brokenRelations).map((relationname=>BrokenRelations_jsx("div",{key:relationname},BrokenRelations_jsx(Divider.c,{section:!0,hidden:!0}),BrokenRelations_jsx("h4",null,BrokenRelations_jsx(message.c,{id:"countBrokenRelations",defaultMessage:"{countofrelation} broken {countofrelation, plural, one {relation} other {relations}} of type {typeofrelation}",values:{countofrelation:brokenRelationStats[relationname],typeofrelation:relationname}})),BrokenRelations_jsx(Table.c,{compact:"very"},BrokenRelations_jsx(Table.c.Header,null,BrokenRelations_jsx(Table.c.Row,null,BrokenRelations_jsx(Table.c.HeaderCell,{width:6},BrokenRelations_jsx(message.c,{id:"Source",defaultMessage:"Source"})),BrokenRelations_jsx(Table.c.HeaderCell,null,BrokenRelations_jsx(message.c,{id:"Target",defaultMessage:"Target"})))),BrokenRelations_jsx(Table.c.Body,null,uniqBy_default()(brokenRelations[relationname].items,(function(el){return el.toString()})).map(((el,index)=>BrokenRelations_jsx(Table.c.Row,{key:index},BrokenRelations_jsx(Table.c.Cell,null,BrokenRelations_jsx(ConditionalLink.c,{to:`${el[0]}/edit`,openLinkInNewTab:!0,condition:el[0].includes("http")},(0,Url._c)(el[0]))),BrokenRelations_jsx(Table.c.Cell,null,BrokenRelations_jsx(ConditionalLink.c,{to:`${el[1]}/edit`,openLinkInNewTab:!0,condition:el[1].includes("http")},(0,Url._c)(el[1]))))))))))))):null};var Relations_BrokenRelations=BrokenRelations;BrokenRelations.__docgenInfo={description:"",methods:[],displayName:"BrokenRelations"};var help=__webpack_require__("./src/icons/help.svg"),help_default=__webpack_require__.n(help),clear=__webpack_require__("./src/icons/clear.svg"),clear_default=__webpack_require__.n(clear),nav=__webpack_require__("./src/icons/nav.svg"),nav_default=__webpack_require__.n(nav),RelationsMatrix_jsx=react.createElement;const RelationsMatrix=props=>{const intl=(0,useIntl.c)(),dispatch=(0,es.useDispatch)(),{0:query_source,1:setQuery_source}=(0,react.useState)(""),{0:query_target,1:setQuery_target}=(0,react.useState)(""),{0:potential_targets_path,1:setPotential_targets_path}=(0,react.useState)(""),{0:potential_sources_path,1:setPotential_sources_path}=(0,react.useState)(""),{0:relationtype,1:setRelationtype}=(0,react.useState)(void 0),actions=(0,es.useSelector)((state=>{var _state$actions$action,_state$actions;return null!==(_state$actions$action=null===(_state$actions=state.actions)||void 0===_state$actions?void 0:_state$actions.actions)&&void 0!==_state$actions$action?_state$actions$action:{}})),can_fix_relations=find_default()(actions.user,{id:"plone_setup"}),relationtypes=(0,es.useSelector)((state=>{var _state$relations,_state$relations$stat,_state$relations$stat2;return null===(_state$relations=state.relations)||void 0===_state$relations||null===(_state$relations$stat=_state$relations.stats)||void 0===_state$relations$stat||null===(_state$relations$stat2=_state$relations$stat.data)||void 0===_state$relations$stat2?void 0:_state$relations$stat2.stats})),relationsListError=(0,es.useSelector)((state=>{var _state$relations2,_state$relations2$sta,_state$relations2$sta2,_state$relations2$sta3,_state$relations2$sta4;return null===(_state$relations2=state.relations)||void 0===_state$relations2||null===(_state$relations2$sta=_state$relations2.stats)||void 0===_state$relations2$sta||null===(_state$relations2$sta2=_state$relations2$sta.error)||void 0===_state$relations2$sta2||null===(_state$relations2$sta3=_state$relations2$sta2.response)||void 0===_state$relations2$sta3||null===(_state$relations2$sta4=_state$relations2$sta3.body)||void 0===_state$relations2$sta4?void 0:_state$relations2$sta4.error})),brokenRelations=(0,es.useSelector)((state=>{var _state$relations3,_state$relations3$sta,_state$relations3$sta2;return null===(_state$relations3=state.relations)||void 0===_state$relations3||null===(_state$relations3$sta=_state$relations3.stats)||void 0===_state$relations3$sta||null===(_state$relations3$sta2=_state$relations3$sta.data)||void 0===_state$relations3$sta2?void 0:_state$relations3$sta2.broken}));let filter_options=(0,es.useSelector)((state=>state.groups.filter_groups));filter_options&&(filter_options=filter_options.map((group=>({value:group.id,label:group.title||group.id}))),filter_options.sort((function(a,b){var labelA=a.label.toUpperCase(),labelB=b.label.toUpperCase();return labelA<labelB?-1:labelA>labelB?1:0}))),(0,react.useEffect)((()=>{dispatch((0,relations_relations.EL)())}),[dispatch]);const onReset=event=>{let element=event.target.querySelector("input");switch(element.value="",element.focus(),element.name){case"SearchY":setQuery_source("");break;case"SearchX":setQuery_target("");break;case"showPotentialTargets":setPotential_targets_path("/");break;case"showPotentialSources":setPotential_sources_path("/")}},onChangeRelation=(event,{value:value})=>{setRelationtype(value)},onChangeShowPotentialSources=_value=>{setPotential_sources_path(_value)},onChangeShowPotentialTargets=_value=>{setPotential_targets_path(_value)},rebuildRelationsHandler=(flush=!1)=>{dispatch(function rebuildRelations(flush=!1){const data=!0===flush?{flush:1}:{};return{type:ActionTypes.kf,request:{op:"post",path:"/@relations/rebuild",data:data}}}(flush)).then((()=>{dispatch((0,relations_relations.EL)()),dispatch((0,relations_relations.yY)(null,!0,"broken"))})).then((()=>{react_toastify.toast.success(RelationsMatrix_jsx(Toast.c,{success:!0,title:intl.formatMessage(MessageLabels.c.success),content:"Relations updated"}))})).catch((error=>{const shadowedError=JSON.parse(error.response.text);react_toastify.toast.error(RelationsMatrix_jsx(Toast.c,{error:!0,title:shadowedError.error.type,content:shadowedError.error.message}))}))},panes=[{menuItem:intl.formatMessage(MessageLabels.c.inspectRelations),pane:RelationsMatrix_jsx(Tab.c.Pane,{attached:!0,key:"fix"},relationtypes?RelationsMatrix_jsx("div",{className:"controlpanel_matrix"},RelationsMatrix_jsx("div",{className:"controlpanel_select_relation"},RelationsMatrix_jsx(Divider.c,{hidden:!0}),RelationsMatrix_jsx(Form.c,{className:"select_relation"},RelationsMatrix_jsx(Form.c.Field,null,RelationsMatrix_jsx(Header.c,{as:"h3"},RelationsMatrix_jsx(Header.c.Content,null,RelationsMatrix_jsx(message.c,{id:"Relation name",defaultMessage:"Relation"})," ",RelationsMatrix_jsx(Dropdown.c,{placeholder:relationtype||intl.formatMessage(MessageLabels.c.selectRelation)},RelationsMatrix_jsx(Dropdown.c.Menu,null,Object.keys(relationtypes).map((relationtype=>RelationsMatrix_jsx(Dropdown.c.Item,{onClick:onChangeRelation,value:relationtype,className:`select-relation-${relationtype}`,key:relationtype},`${relationtype} (${relationtypes[relationtype]})`)))))))))),relationtype?RelationsMatrix_jsx(react.Fragment,null,RelationsMatrix_jsx("div",{className:"controlpanel_search_wrapper"},RelationsMatrix_jsx("div",{className:"controlpanel_search_y"},RelationsMatrix_jsx(Header.c,{as:"h4"},RelationsMatrix_jsx(Header.c.Content,null,RelationsMatrix_jsx(message.c,{id:"Source",defaultMessage:"Source"}))),RelationsMatrix_jsx(Form.c,{className:"search_y",onSubmit:onReset},RelationsMatrix_jsx(Form.c.Field,null,RelationsMatrix_jsx(Input.c,{name:"SearchY",placeholder:intl.formatMessage(MessageLabels.c.searchRelationSource),onChange:event=>{event.target.value.length>1?setQuery_source(event.target.value):setQuery_source("")},id:"y-search-input"}),RelationsMatrix_jsx(Button.c.Group,null,RelationsMatrix_jsx(Button.c,{basic:!0,className:"cancel","aria-label":"cancel",onClick:e=>{e.preventDefault(),e.stopPropagation(),document.querySelector('input[name="SearchY"]').value="",setQuery_source("")}},RelationsMatrix_jsx(Icon.c,{name:clear_default(),size:"24px"}))))),RelationsMatrix_jsx(Form.c,{className:"add_potential_sources",onSubmit:onReset},RelationsMatrix_jsx(Form.c.Field,null,RelationsMatrix_jsx(Input.c,{name:"showPotentialSources",type:"url",value:potential_sources_path,placeholder:intl.formatMessage(MessageLabels.c.addPotentialSourcesPath),onChange:({target:target})=>onChangeShowPotentialSources(target.value),id:"potential-sources-path-input"}),(null==potential_sources_path?void 0:potential_sources_path.length)>0?RelationsMatrix_jsx(Button.c.Group,null,RelationsMatrix_jsx(Button.c,{basic:!0,className:"cancel","aria-label":"clearUrlBrowser",onClick:e=>{e.preventDefault(),e.stopPropagation(),setPotential_sources_path("")}},RelationsMatrix_jsx(Icon.c,{name:clear_default(),size:"24px"}))):RelationsMatrix_jsx(Button.c.Group,null,RelationsMatrix_jsx(Button.c,{basic:!0,icon:!0,"aria-label":"openUrlBrowser",onClick:e=>{e.preventDefault(),e.stopPropagation(),props.openObjectBrowser({mode:"link",overlay:!0,onSelectItem:url=>{onChangeShowPotentialSources(url)}})}},RelationsMatrix_jsx(Icon.c,{name:nav_default(),size:"24px"})))),RelationsMatrix_jsx(message.c,{id:"Show potential sources. Not only objects that are source of some relation.",defaultMessage:"Show potential sources. Not only objects that are source of some relation."}))),RelationsMatrix_jsx("div",{className:"controlpanel_search_x"},RelationsMatrix_jsx(Form.c,{className:"search_x",onSubmit:onReset},RelationsMatrix_jsx(Header.c,{as:"h4"},RelationsMatrix_jsx(Header.c.Content,null,RelationsMatrix_jsx(message.c,{id:"Target",defaultMessage:"Target"}))),RelationsMatrix_jsx(Form.c.Field,null,RelationsMatrix_jsx(Input.c,{name:"SearchX",placeholder:intl.formatMessage(MessageLabels.c.searchRelationTarget),onChange:event=>{event.target.value.length>1?setQuery_target(event.target.value):setQuery_source("")},id:"x-search-input"}),RelationsMatrix_jsx(Button.c.Group,null,RelationsMatrix_jsx(Button.c,{basic:!0,className:"cancel","aria-label":"cancel",onClick:e=>{e.preventDefault(),e.stopPropagation(),document.querySelector('input[name="SearchX"]').value="",setQuery_target("")}},RelationsMatrix_jsx(Icon.c,{name:clear_default(),size:"24px"}))))),RelationsMatrix_jsx(Form.c,{className:"add_potential_targets",onSubmit:onReset},RelationsMatrix_jsx(Form.c.Field,null,RelationsMatrix_jsx(Input.c,{name:"showPotentialTargets",type:"url",value:potential_targets_path,placeholder:intl.formatMessage(MessageLabels.c.addPotentialTargetsPath),onChange:({target:target})=>onChangeShowPotentialTargets(target.value),id:"potential-targets-path-input"}),(null==potential_targets_path?void 0:potential_targets_path.length)>0?RelationsMatrix_jsx(Button.c.Group,null,RelationsMatrix_jsx(Button.c,{basic:!0,className:"cancel","aria-label":"clearUrlBrowser",onClick:e=>{e.preventDefault(),e.stopPropagation(),setPotential_targets_path("")}},RelationsMatrix_jsx(Icon.c,{name:clear_default(),size:"24px"}))):RelationsMatrix_jsx(Button.c.Group,null,RelationsMatrix_jsx(Button.c,{basic:!0,icon:!0,"aria-label":"openUrlBrowser",onClick:e=>{e.preventDefault(),e.stopPropagation(),props.openObjectBrowser({mode:"link",overlay:!0,onSelectItem:url=>{onChangeShowPotentialTargets(url)}})}},RelationsMatrix_jsx(Icon.c,{name:nav_default(),size:"24px"})))),RelationsMatrix_jsx("div",{className:"foo"},RelationsMatrix_jsx(message.c,{id:"Show potential targets. Not only objects that are target of some relation.",defaultMessage:"Show potential targets. Not only objects that are target of some relation."})," ",RelationsMatrix_jsx(Popup.c,{trigger:RelationsMatrix_jsx("a",{href:"https://6.docs.plone.org/volto/development/widget.html#widget-relation-field-label",target:"_blank",rel:"noopener noreferrer"},RelationsMatrix_jsx(Icon.c,{name:help_default(),size:"16px"}))},RelationsMatrix_jsx(Popup.c.Header,null,"Respect constraints"),RelationsMatrix_jsx(Popup.c.Content,null,RelationsMatrix_jsx("div",null,"See docs.plone.org on how to respect constraints."))))))),RelationsMatrix_jsx("div",{className:"controlpanel_listing_wrapper"},RelationsMatrix_jsx(Relations_RelationsListing,{relationtype:relationtype,query_source:query_source,query_target:query_target,potential_targets_path:potential_targets_path,potential_sources_path:potential_sources_path}))):null):RelationsMatrix_jsx("p",null,RelationsMatrix_jsx("b",null,null==relationsListError?void 0:relationsListError.type)," ",null==relationsListError?void 0:relationsListError.message))},{menuItem:intl.formatMessage(MessageLabels.c.fixRelations),pane:RelationsMatrix_jsx(Tab.c.Pane,{attached:!0,key:"rebuild"},RelationsMatrix_jsx("div",null,!(brokenRelations&&Object.keys(brokenRelations).length>0)&&RelationsMatrix_jsx("div",null,RelationsMatrix_jsx(message.c,{id:"No broken relations found.",defaultMessage:"No broken relations found."})),can_fix_relations?RelationsMatrix_jsx(react.Fragment,null,RelationsMatrix_jsx(Divider.c,{hidden:!0}),RelationsMatrix_jsx("h2",null,capitalize_default()(intl.formatMessage(MessageLabels.c.rebuildRelations))),RelationsMatrix_jsx(Button.c.Group,null,RelationsMatrix_jsx(Button.c,{primary:!0,onClick:()=>rebuildRelationsHandler(!1),content:intl.formatMessage(MessageLabels.c.rebuildRelations),"aria-label":intl.formatMessage(MessageLabels.c.rebuildRelations)})),RelationsMatrix_jsx(Divider.c,{hidden:!0}),RelationsMatrix_jsx("h2",null,capitalize_default()(intl.formatMessage(MessageLabels.c.flushAndRebuildRelations))),RelationsMatrix_jsx("div",{dangerouslySetInnerHTML:{__html:intl.formatMessage(MessageLabels.c.flushAndRebuildRelationsHints)}}),RelationsMatrix_jsx(Divider.c,{hidden:!0}),RelationsMatrix_jsx(Button.c.Group,null,RelationsMatrix_jsx(Button.c,{secondary:!0,color:"red",onClick:()=>rebuildRelationsHandler(!0),content:intl.formatMessage(MessageLabels.c.flushAndRebuildRelations),"aria-label":intl.formatMessage(MessageLabels.c.flushAndRebuildRelations)}))):null,RelationsMatrix_jsx(Relations_BrokenRelations,null)))}];return RelationsMatrix_jsx(Tab.c,{panes:panes,renderActiveOnly:!1,menu:{secondary:!0,pointing:!0,attached:!0,tabular:!0}})};var Relations_RelationsMatrix=(0,redux.compose)(ObjectBrowser.c)(RelationsMatrix);RelationsMatrix.__docgenInfo={description:"",methods:[],displayName:"RelationsMatrix"};var back=__webpack_require__("./src/icons/back.svg"),back_default=__webpack_require__.n(back),Relations_jsx=react.createElement;const RelationsControlPanel=()=>{const intl=(0,useIntl.c)(),history=(0,react_router.Uz)(),location=(0,react_router.IT)(),dispatch=(0,es.useDispatch)(),{0:isClient,1:setIsClient}=(0,react.useState)(!1);(0,react.useEffect)((()=>{setIsClient(!0)}),[]);const brokenRelations=(0,es.useSelector)((state=>{var _state$relations,_state$relations$stat,_state$relations$stat2;return null===(_state$relations=state.relations)||void 0===_state$relations||null===(_state$relations$stat=_state$relations.stats)||void 0===_state$relations$stat||null===(_state$relations$stat2=_state$relations$stat.data)||void 0===_state$relations$stat2?void 0:_state$relations$stat2.broken})),relations_stats=(0,es.useSelector)((state=>{var _state$relations2,_state$relations2$sta;return null===(_state$relations2=state.relations)||void 0===_state$relations2||null===(_state$relations2$sta=_state$relations2.stats)||void 0===_state$relations2$sta?void 0:_state$relations2$sta.data})),actions=(0,es.useSelector)((state=>{var _state$actions$action,_state$actions;return null!==(_state$actions$action=null===(_state$actions=state.actions)||void 0===_state$actions?void 0:_state$actions.actions)&&void 0!==_state$actions$action?_state$actions$action:{}})),can_edit=find_default()(actions.object,{id:"edit"});return(0,react.useEffect)((()=>{dispatch((0,actions_actions.K)("/"))}),[dispatch]),Relations_jsx(react.Fragment,null,Relations_jsx("div",{className:"relations-control-panel"},Relations_jsx(Helmet.c,{title:intl.formatMessage(MessageLabels.c.relations)}),can_edit?Relations_jsx(Segment.c.Group,{raised:!0},Relations_jsx(Segment.c,{className:"primary"},brokenRelations&&Object.keys(brokenRelations).length>0?Relations_jsx(react.Fragment,null,Relations_jsx(Message.c,{warning:!0},Relations_jsx(message.c,{id:"Some relations are broken. Please fix.",defaultMessage:"Some relations are broken. Please fix."})),Relations_jsx(Divider.c,{hidden:!0})):null,Relations_jsx("h1",null,Relations_jsx(message.c,{id:"Relations",defaultMessage:"Relations"})),null!=relations_stats&&relations_stats.error?Relations_jsx(react.Fragment,null,Relations_jsx(Divider.c,{hidden:!0}),Relations_jsx(Message.c,{warning:!0},Relations_jsx(message.c,{id:"Please upgrade to plone.restapi >= 8.39.0.",defaultMessage:"Please upgrade to plone.restapi >= 8.39.0."}))):null),Relations_jsx(Segment.c,null,Relations_jsx(Relations_RelationsMatrix,null))):Relations_jsx(Segment.c.Group,null,Relations_jsx(Segment.c,null,Relations_jsx(message.c,{id:"Relations",defaultMessage:"Relations"}),Relations_jsx(Divider.c,{hidden:!0}),Relations_jsx(message.c,{id:"You have not the required permission for this control panel.",defaultMessage:"You have not the required permission for this control panel."})))),isClient&&(0,react_dom.createPortal)(Relations_jsx(Toolbar.c,{pathname:location.pathname,hideDefaultViewButtons:!0,inner:Relations_jsx(react_router_dom.cH,{className:"item",to:"#",onClick:()=>{history.push((0,Url.yn)(location.pathname))}},Relations_jsx(Icon.c,{name:back_default(),className:"contents circled",size:"30px"}))}),document.getElementById("toolbar")))};var Relations=RelationsControlPanel;RelationsControlPanel.__docgenInfo={description:"",methods:[],displayName:"RelationsControlPanel"}},"../../../node_modules/.pnpm/lodash@4.17.21/node_modules/lodash/capitalize.js":function(module,__unused_webpack_exports,__webpack_require__){var toString=__webpack_require__("../../../node_modules/.pnpm/lodash@4.17.21/node_modules/lodash/toString.js"),upperFirst=__webpack_require__("../../../node_modules/.pnpm/lodash@4.17.21/node_modules/lodash/upperFirst.js");module.exports=function capitalize(string){return upperFirst(toString(string).toLowerCase())}},"../../../node_modules/.pnpm/semantic-ui-react@2.1.5_react-dom@18.2.0_react@18.2.0__react@18.2.0/node_modules/semantic-ui-react/dist/es/elements/Divider/Divider.js":function(__unused_webpack_module,__webpack_exports__,__webpack_require__){"use strict";var _babel_runtime_helpers_esm_extends__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("../../../node_modules/.pnpm/@babel+runtime@7.20.6/node_modules/@babel/runtime/helpers/esm/extends.js"),clsx__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("../../../node_modules/.pnpm/clsx@1.2.1/node_modules/clsx/dist/clsx.m.js"),react__WEBPACK_IMPORTED_MODULE_1__=(__webpack_require__("../../../node_modules/.pnpm/prop-types@15.7.2/node_modules/prop-types/index.js"),__webpack_require__("../../../node_modules/.pnpm/react@18.2.0/node_modules/react/index.js")),_lib__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("../../../node_modules/.pnpm/semantic-ui-react@2.1.5_react-dom@18.2.0_react@18.2.0__react@18.2.0/node_modules/semantic-ui-react/dist/es/lib/classNameBuilders.js"),_lib__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("../../../node_modules/.pnpm/semantic-ui-react@2.1.5_react-dom@18.2.0_react@18.2.0__react@18.2.0/node_modules/semantic-ui-react/dist/es/lib/getUnhandledProps.js"),_lib__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("../../../node_modules/.pnpm/semantic-ui-react@2.1.5_react-dom@18.2.0_react@18.2.0__react@18.2.0/node_modules/semantic-ui-react/dist/es/lib/getElementType.js"),_lib__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("../../../node_modules/.pnpm/semantic-ui-react@2.1.5_react-dom@18.2.0_react@18.2.0__react@18.2.0/node_modules/semantic-ui-react/dist/es/lib/childrenUtils.js");function Divider(props){var children=props.children,className=props.className,clearing=props.clearing,content=props.content,fitted=props.fitted,hidden=props.hidden,horizontal=props.horizontal,inverted=props.inverted,section=props.section,vertical=props.vertical,classes=(0,clsx__WEBPACK_IMPORTED_MODULE_2__.c)("ui",(0,_lib__WEBPACK_IMPORTED_MODULE_3__.gj)(clearing,"clearing"),(0,_lib__WEBPACK_IMPORTED_MODULE_3__.gj)(fitted,"fitted"),(0,_lib__WEBPACK_IMPORTED_MODULE_3__.gj)(hidden,"hidden"),(0,_lib__WEBPACK_IMPORTED_MODULE_3__.gj)(horizontal,"horizontal"),(0,_lib__WEBPACK_IMPORTED_MODULE_3__.gj)(inverted,"inverted"),(0,_lib__WEBPACK_IMPORTED_MODULE_3__.gj)(section,"section"),(0,_lib__WEBPACK_IMPORTED_MODULE_3__.gj)(vertical,"vertical"),"divider",className),rest=(0,_lib__WEBPACK_IMPORTED_MODULE_4__.c)(Divider,props),ElementType=(0,_lib__WEBPACK_IMPORTED_MODULE_5__.c)(Divider,props);return react__WEBPACK_IMPORTED_MODULE_1__.createElement(ElementType,(0,_babel_runtime_helpers_esm_extends__WEBPACK_IMPORTED_MODULE_6__.c)({},rest,{className:classes}),_lib__WEBPACK_IMPORTED_MODULE_7__.Ar(children)?content:children)}Divider.handledProps=["as","children","className","clearing","content","fitted","hidden","horizontal","inverted","section","vertical"],Divider.propTypes={},__webpack_exports__.c=Divider},"./src/icons/help.svg":function(module){module.exports={attributes:{xmlns:"http://www.w3.org/2000/svg",width:"36",height:"36",viewBox:"0 0 36 36"},content:'<g fill-rule="evenodd"><path d="M19.5,24 C19.5,24.828 18.828,25.5 18,25.5 C17.172,25.5 16.5,24.828 16.5,24 C16.5,23.172 17.172,22.5 18,22.5 C18.828,22.5 19.5,23.172 19.5,24"/><path d="M18,5 C10.832,5 5,10.832 5,18 C5,25.168 10.832,31 18,31 C25.168,31 31,25.168 31,18 C31,10.832 25.168,5 18,5 M18,33 C9.729,33 3,26.271 3,18 C3,9.729 9.729,3 18,3 C26.271,3 33,9.729 33,18 C33,26.271 26.271,33 18,33"/><path d="M19,20 L17,20 C17,17.456 19.437,16.166 19.54,16.112 C19.558,16.104 21,15.334 21,14 C21,12.346 19.654,11 18,11 C16.346,11 15,12.346 15,14 L13,14 C13,11.243 15.243,9 18,9 C20.757,9 23,11.243 23,14 C23,16.572 20.556,17.84 20.452,17.893 C20.45,17.894 19,18.682 19,20"/></g>'}}}]);